<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="KLM CRM – Hugo Publishing Process (Staging & Production)# Purpose# This document defines the end‑to‑end publishing workflow for deploying a Hugo static site to KLM staging (klmcrm) and production (klminsurance) using AWS S3 and CloudFront. It is designed to:
Support a new MacBook and fresh Hugo install Assume AWS CLI credentials are already configured (but provide verification steps) Clearly identify what credentials are required vs. not required Provide safe, repeatable steps to fully replace (delete + upload) S3 site content Align with the established script‑driven KLM workflow All credentials are documented with placeholders where sensitive data is not available or should not be stored.
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/documents/klm-migrate/klm_crm_publishing_process/"><meta property="og:site_name" content="My Projects - Documentation Hub"><meta property="og:title" content="klm_crm_publishing_process"><meta property="og:description" content="KLM CRM – Hugo Publishing Process (Staging & Production)# Purpose# This document defines the end‑to‑end publishing workflow for deploying a Hugo static site to KLM staging (klmcrm) and production (klminsurance) using AWS S3 and CloudFront. It is designed to:
Support a new MacBook and fresh Hugo install Assume AWS CLI credentials are already configured (but provide verification steps) Clearly identify what credentials are required vs. not required Provide safe, repeatable steps to fully replace (delete + upload) S3 site content Align with the established script‑driven KLM workflow All credentials are documented with placeholders where sensitive data is not available or should not be stored."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="documents"><meta property="article:published_time" content="2025-12-22T14:00:56+00:00"><meta property="article:modified_time" content="2025-12-22T14:00:56+00:00"><meta itemprop=name content="klm_crm_publishing_process"><meta itemprop=description content="KLM CRM – Hugo Publishing Process (Staging & Production)# Purpose# This document defines the end‑to‑end publishing workflow for deploying a Hugo static site to KLM staging (klmcrm) and production (klminsurance) using AWS S3 and CloudFront. It is designed to:
Support a new MacBook and fresh Hugo install Assume AWS CLI credentials are already configured (but provide verification steps) Clearly identify what credentials are required vs. not required Provide safe, repeatable steps to fully replace (delete + upload) S3 site content Align with the established script‑driven KLM workflow All credentials are documented with placeholders where sensitive data is not available or should not be stored."><meta itemprop=datePublished content="2025-12-22T14:00:56+00:00"><meta itemprop=dateModified content="2025-12-22T14:00:56+00:00"><meta itemprop=wordCount content="520"><title>klm_crm_publishing_process | My Projects - Documentation Hub</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=http://localhost:1313/documents/klm-migrate/klm_crm_publishing_process/><link rel=stylesheet href=/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj+RQ9XBXU=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.da5a5af27f9bdea67bd6f07f3142824ec301e0c7f9d37c0fc61aefc961834a9e.js integrity="sha256-2lpa8n+b3qZ71vB/MUKCTsMB4Mf503wPxhrvyWGDSp4=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-documents"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>My Projects - Documentation Hub</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/icons/menu.svg class=book-icon alt=Menu></label><h3>klm_crm_publishing_process</h3><label for=toc-control><img src=/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#klm-crm--hugo-publishing-process-staging--production>KLM CRM – Hugo Publishing Process (Staging & Production)</a><ul><li><a href=#purpose>Purpose</a></li><li><a href=#highlevel-architecture>High‑Level Architecture</a></li><li><a href=#environments>Environments</a></li><li><a href=#required-software-mac>Required Software (Mac)</a></li><li><a href=#aws-credentials-placeholders>AWS Credentials (Placeholders)</a><ul><li><a href=#aws-account>AWS Account</a></li><li><a href=#iam-identity-cli>IAM Identity (CLI)</a></li></ul></li><li><a href=#required-iam-permissions>Required IAM Permissions</a></li><li><a href=#verification--aws-cli-setup>Verification – AWS CLI Setup</a></li><li><a href=#hugo-site-verification>Hugo Site Verification</a></li><li><a href=#build-commands>Build Commands</a><ul><li><a href=#staging-build>Staging Build</a></li><li><a href=#production-build>Production Build</a></li></ul></li><li><a href=#prepublish-safety-check-optional>Pre‑Publish Safety Check (Optional)</a></li><li><a href=#publish-to-staging-full-replace>Publish to Staging (FULL REPLACE)</a></li><li><a href=#publish-to-production-full-replace>Publish to Production (FULL REPLACE)</a></li><li><a href=#cloudfront-cache-invalidation-recommended>CloudFront Cache Invalidation (Recommended)</a></li><li><a href=#postpublish-validation>Post‑Publish Validation</a></li><li><a href=#what-is-not-needed>What Is <em>Not</em> Needed</a></li><li><a href=#common-failure-points>Common Failure Points</a></li><li><a href=#recommended-next-step>Recommended Next Step</a></li><li><a href=#summary>Summary</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=klm-crm--hugo-publishing-process-staging--production>KLM CRM – Hugo Publishing Process (Staging & Production)<a class=anchor href=#klm-crm--hugo-publishing-process-staging--production>#</a></h1><h2 id=purpose>Purpose<a class=anchor href=#purpose>#</a></h2><p>This document defines the <strong>end‑to‑end publishing workflow</strong> for deploying a Hugo static site to <strong>KLM staging (klmcrm)</strong> and <strong>production (klminsurance)</strong> using AWS S3 and CloudFront. It is designed to:</p><ul><li>Support a <strong>new MacBook</strong> and fresh Hugo install</li><li>Assume <strong>AWS CLI credentials are already configured</strong> (but provide verification steps)</li><li>Clearly identify <strong>what credentials are required vs. not required</strong></li><li>Provide <strong>safe, repeatable steps</strong> to fully replace (delete + upload) S3 site content</li><li>Align with the established <strong>script‑driven KLM workflow</strong></li></ul><p>All credentials are documented with <strong>placeholders</strong> where sensitive data is not available or should not be stored.</p><hr><h2 id=highlevel-architecture>High‑Level Architecture<a class=anchor href=#highlevel-architecture>#</a></h2><pre tabindex=0><code>Local MacBook
  └─ Hugo site (source)
      └─ hugo build
          └─ public/ (static output)
              └─ aws s3 sync --delete
                  └─ S3 bucket (private)
                      └─ CloudFront distribution</code></pre><p>Key principle: <strong>S3 is private</strong>, CloudFront is the public entry point.</p><hr><h2 id=environments>Environments<a class=anchor href=#environments>#</a></h2><table><thead><tr><th>Environment</th><th>Domain</th><th>S3 Bucket</th><th>Base URL</th></tr></thead><tbody><tr><td>Staging</td><td><a href=https://www.klmcrm.com>www.klmcrm.com</a></td><td>s3://klmcrm.com</td><td><a href=https://www.klmcrm.com>https://www.klmcrm.com</a></td></tr><tr><td>Production</td><td><a href=https://www.klminsurance.com>www.klminsurance.com</a></td><td>s3://klminsurance.com</td><td><a href=https://www.klminsurance.com>https://www.klminsurance.com</a></td></tr></tbody></table><hr><h2 id=required-software-mac>Required Software (Mac)<a class=anchor href=#required-software-mac>#</a></h2><p>Verify the following are installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hugo version
</span></span><span style=display:flex><span>aws --version
</span></span><span style=display:flex><span>python3 --version
</span></span><span style=display:flex><span>git --version</span></span></code></pre></div><p>Expected:</p><ul><li>Hugo ≥ extended version</li><li>AWS CLI v2</li><li>Python 3.9+ (Anaconda acceptable)</li></ul><hr><h2 id=aws-credentials-placeholders>AWS Credentials (Placeholders)<a class=anchor href=#aws-credentials-placeholders>#</a></h2><h3 id=aws-account>AWS Account<a class=anchor href=#aws-account>#</a></h3><pre tabindex=0><code>AWS Account ID: &lt;AWS_ACCOUNT_ID&gt;
AWS Region: us-east-1</code></pre><h3 id=iam-identity-cli>IAM Identity (CLI)<a class=anchor href=#iam-identity-cli>#</a></h3><p>The AWS CLI <strong>must already be authenticated</strong>.</p><pre tabindex=0><code>IAM User or Role Name: &lt;IAM_PRINCIPAL_NAME&gt;
Access Type: programmatic (CLI)</code></pre><p><strong>No access keys are required in this document.</strong></p><hr><h2 id=required-iam-permissions>Required IAM Permissions<a class=anchor href=#required-iam-permissions>#</a></h2><p>The publishing principal must have at minimum:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;s3:ListBucket&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;s3:PutObject&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;s3:DeleteObject&#34;</span>
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;arn:aws:s3:::klmcrm.com&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;arn:aws:s3:::klmcrm.com/*&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;arn:aws:s3:::klminsurance.com&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;arn:aws:s3:::klminsurance.com/*&#34;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Optional but recommended:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Action&#34;</span>: <span style=color:#e6db74>&#34;cloudfront:CreateInvalidation&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Resource&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><hr><h2 id=verification--aws-cli-setup>Verification – AWS CLI Setup<a class=anchor href=#verification--aws-cli-setup>#</a></h2><p>Run <strong>before publishing</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws sts get-caller-identity</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>Account: &lt;AWS_ACCOUNT_ID&gt;
Arn: arn:aws:iam::&lt;AWS_ACCOUNT_ID&gt;:user/&lt;IAM_PRINCIPAL_NAME&gt;</code></pre><p>If this fails, publishing <strong>will not work</strong>.</p><hr><h2 id=hugo-site-verification>Hugo Site Verification<a class=anchor href=#hugo-site-verification>#</a></h2><p>From the Hugo project root:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hugo env
</span></span><span style=display:flex><span>hugo config</span></span></code></pre></div><p>Confirm:</p><ul><li>Correct theme loaded</li><li>No hard‑coded baseURL (or overridden via flags)</li></ul><hr><h2 id=build-commands>Build Commands<a class=anchor href=#build-commands>#</a></h2><h3 id=staging-build>Staging Build<a class=anchor href=#staging-build>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hugo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --baseURL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://www.klmcrm.com&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --environment staging <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --destination public</span></span></code></pre></div><h3 id=production-build>Production Build<a class=anchor href=#production-build>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hugo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --baseURL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://www.klminsurance.com&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --environment production <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --destination public</span></span></code></pre></div><hr><h2 id=prepublish-safety-check-optional>Pre‑Publish Safety Check (Optional)<a class=anchor href=#prepublish-safety-check-optional>#</a></h2><p>List existing objects:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 ls s3://klmcrm.com --recursive | head</span></span></code></pre></div><hr><h2 id=publish-to-staging-full-replace>Publish to Staging (FULL REPLACE)<a class=anchor href=#publish-to-staging-full-replace>#</a></h2><p>This <strong>deletes all existing content</strong> and replaces it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 sync public/ s3://klmcrm.com <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --delete</span></span></code></pre></div><p>Notes:</p><ul><li><code>--delete</code> removes stale files</li><li>Bucket must be private</li></ul><hr><h2 id=publish-to-production-full-replace>Publish to Production (FULL REPLACE)<a class=anchor href=#publish-to-production-full-replace>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 sync public/ s3://klminsurance.com <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --delete</span></span></code></pre></div><hr><h2 id=cloudfront-cache-invalidation-recommended>CloudFront Cache Invalidation (Recommended)<a class=anchor href=#cloudfront-cache-invalidation-recommended>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudfront create-invalidation <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --distribution-id &lt;CLOUDFRONT_DISTRIBUTION_ID&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --paths <span style=color:#e6db74>&#34;/*&#34;</span></span></span></code></pre></div><p>Placeholders:</p><pre tabindex=0><code>Staging Distribution ID: &lt;CF_DIST_ID_STAGING&gt;
Production Distribution ID: &lt;CF_DIST_ID_PROD&gt;</code></pre><hr><h2 id=postpublish-validation>Post‑Publish Validation<a class=anchor href=#postpublish-validation>#</a></h2><ol><li>Load homepage in browser</li><li>View page source → confirm updated build timestamp</li><li>Spot‑check:<ul><li>Navigation</li><li>CSS/JS loading</li><li>Images</li></ul></li></ol><hr><h2 id=what-is-not-needed>What Is <em>Not</em> Needed<a class=anchor href=#what-is-not-needed>#</a></h2><ul><li>❌ No S3 public ACLs</li><li>❌ No manual file uploads</li><li>❌ No AWS Console interaction</li><li>❌ No credentials embedded in Hugo</li></ul><p>If <code>aws sts get-caller-identity</code> works, <strong>you are authorized</strong>.</p><hr><h2 id=common-failure-points>Common Failure Points<a class=anchor href=#common-failure-points>#</a></h2><table><thead><tr><th>Issue</th><th>Cause</th></tr></thead><tbody><tr><td>AccessDenied</td><td>Missing IAM permissions</td></tr><tr><td>Old content</td><td>Forgot <code>--delete</code></td></tr><tr><td>Wrong URLs</td><td>baseURL mismatch</td></tr><tr><td>403 errors</td><td>CloudFront origin misconfigured</td></tr></tbody></table><hr><h2 id=recommended-next-step>Recommended Next Step<a class=anchor href=#recommended-next-step>#</a></h2><p>Automate the above into:</p><pre tabindex=0><code>workflow/publish_to_staging.py
workflow/publish_to_production.py</code></pre><p>Using the existing <strong>KLM script‑driven workflow</strong>.</p><hr><h2 id=summary>Summary<a class=anchor href=#summary>#</a></h2><p>You are correctly positioned to:</p><ul><li>Publish from a <strong>new MacBook</strong></li><li>Fully replace S3 site content</li><li>Operate without exposing credentials</li><li>Validate configuration before deployment</li></ul><p>This process is <strong>safe, repeatable, and production‑grade</strong>.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#klm-crm--hugo-publishing-process-staging--production>KLM CRM – Hugo Publishing Process (Staging & Production)</a><ul><li><a href=#purpose>Purpose</a></li><li><a href=#highlevel-architecture>High‑Level Architecture</a></li><li><a href=#environments>Environments</a></li><li><a href=#required-software-mac>Required Software (Mac)</a></li><li><a href=#aws-credentials-placeholders>AWS Credentials (Placeholders)</a><ul><li><a href=#aws-account>AWS Account</a></li><li><a href=#iam-identity-cli>IAM Identity (CLI)</a></li></ul></li><li><a href=#required-iam-permissions>Required IAM Permissions</a></li><li><a href=#verification--aws-cli-setup>Verification – AWS CLI Setup</a></li><li><a href=#hugo-site-verification>Hugo Site Verification</a></li><li><a href=#build-commands>Build Commands</a><ul><li><a href=#staging-build>Staging Build</a></li><li><a href=#production-build>Production Build</a></li></ul></li><li><a href=#prepublish-safety-check-optional>Pre‑Publish Safety Check (Optional)</a></li><li><a href=#publish-to-staging-full-replace>Publish to Staging (FULL REPLACE)</a></li><li><a href=#publish-to-production-full-replace>Publish to Production (FULL REPLACE)</a></li><li><a href=#cloudfront-cache-invalidation-recommended>CloudFront Cache Invalidation (Recommended)</a></li><li><a href=#postpublish-validation>Post‑Publish Validation</a></li><li><a href=#what-is-not-needed>What Is <em>Not</em> Needed</a></li><li><a href=#common-failure-points>Common Failure Points</a></li><li><a href=#recommended-next-step>Recommended Next Step</a></li><li><a href=#summary>Summary</a></li></ul></li></ul></nav></div></aside></main></body></html>